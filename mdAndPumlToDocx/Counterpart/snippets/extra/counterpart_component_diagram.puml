@startuml
title Component Diagram - Counterpart Flow

skinparam componentStyle rectangle
skinparam shadowing false
skinparam rectangle {
  BackgroundColor #F4F9FF
  BorderColor #4169E1
  FontColor #000000
}
skinparam note {
  BackgroundColor #FFFDE7
  BorderColor #BDB76B
}

' === Components ===
rectangle "Client\n(UI / Consumer)" as Client #white
rectangle "Counterpart API\n(Interface Layer)" as API
rectangle "Counterpart Service\n(Integration Layer)" as Service
rectangle "Document Node Service\n(Node Management)" as NodeService
rectangle "Excel Processor\n(Excel Parser)" as ExcelProcessor
rectangle "Microservice RepurposingReg\n(meRepurposingReg)" as MS

' === Relationships ===
Client --> API : REST calls\n(GET / POST / PATCH / DELETE)
API --> Service : Internal service routes
Service --> ExcelProcessor : Parse Excel → JSON request
Service --> NodeService : Create & Link Document Nodes
Service --> MS : REST calls to external MS\n(GET / POST / PATCH / DELETE)

' === Notes on API ===
note right of API
Espone i seguenti endpoint REST:
- GET /v1/counterparts/{id}
- PATCH /v1/counterparts/{id}
- POST /v1/counterparts
- DELETE /v1/counterparts/{id}
- POST /v1/counterparts/search
- POST /v1/counterparts/import

Ogni endpoint inoltra la richiesta
alla relativa route interna del Service.
end note

' === Notes on Service ===
note right of Service
Implementa la logica del dominio Counterpart:

- SEARCH_COUNTERPART → chiama MS per la ricerca
- SEARCH_COUNTERPART_BY_ID → chiama MS per singolo ID
- CREATE_COUNTERPART → wrappa richiesta singola in "multi"
- UPDATE_COUNTERPART_BY_ID → traduce in update multi
- DELETE_COUNTERPART_BY_ID → inoltra DELETE a MS
- CREATE_COUNTERPART_EXCEL → usa ExcelProcessor
- CREATE_NODE_FOR_COUNTERPART_LIST → crea e collega nodi
- SEARCH_COUNTERPART_FOR_CREATE_NODE → ricerca per nodeId
end note

' === Notes on ExcelProcessor ===
note right of ExcelProcessor
Converte il file Excel ricevuto da /import
in un WrapperCounterpartCreateDTORequest { items[] }.
end note

' === Notes on NodeService ===
note right of NodeService
Gestisce i Document Nodes associati a ogni Counterpart:
- Creazione nodo
- Rinomina o spostamento in base ai campi modificati
Dopo la creazione, aggiorna i record con il nodeId.
end note

' === Notes on MS ===
note right of MS
Microservizio esterno orchestrato
(meRepurposingReg) responsabile della persistenza
e gestione dati di CounterpartEntity.
end note

@enduml
